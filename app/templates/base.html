<!doctype html>
{# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–≤–æ–¥–∞ #}
{% from "macros/translations.html" import language_switcher with context %}
{# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º CSRF –º–∞–∫—Ä–æ—Å #}
{% from "macros/forms.html" import csrf_field with context %}
<html lang="{{ g.locale }}">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Rozoom-KI{% endblock %}</title>
    {% block head %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/animations.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dark-background.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/particles-bg.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/particles-sphere.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/video-background.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/video-hero.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/video-responsive.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/language_switcher.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/fix-contrast.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/no-icons.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/blog-fixes.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chat-widget.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chat-header.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chat-fixes.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/agent-transitions.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tech-spec.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/footer.css') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/favicon.png') }}">
    <!-- Inline styles for ensuring high contrast in chat -->
    <style>
      /* Critical inline styles for chatbot */
      .chat-msg.bot {
        background-color: #2980b9 !important; /* Deeper blue for better contrast */
        color: #ffffff !important;
        text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2) !important;
      }
      
      .chat-msg.user {
        background-color: #2ecc71 !important;
        color: #ffffff !important;
      }
      
      .chat-window {
        background: #1e2732 !important;
      }
      
      .chat-messages {
        background: #1e2732 !important;
      }
    </style>
    <!-- –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: —É–¥–∞–ª–µ–Ω –Ω–µ–Ω—É–∂–Ω—ã–π –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–π —Ç–µ–≥ script -->
    <style>
      /* –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ CSS –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤—Å–µ—Ö Font Awesome –∏–∫–æ–Ω–æ–∫ */
      i.fas, i.fab, i.fa, i.far, i[class^="fa"], i[class*=" fa"],
      .fas, .fab, .fa, .far, [class^="fa-"], [class*=" fa-"] {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        width: 0 !important;
        height: 0 !important;
        overflow: hidden !important;
        margin: 0 !important;
        padding: 0 !important;
      }
      
      /* –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–∫–æ–Ω–∫–∏ –≤ —Å—Ç–∞—Ç—å—è—Ö */
      .blog-post-content i, .blog-post-meta i, .blog-post-title i {
        display: none !important;
        visibility: hidden !important;
      }
    </style>
    {% endblock %}
  <body>
    <!-- Particles.js background -->
    <div id="particles-js"></div>
    <div id="particles-overlay"></div>
    <!-- Dark Animated Background -->
    <div class="dark-animated-background">
      <div class="gradient-layer"></div>
      <div class="blur-layer"></div>
      <div class="stars-layer"></div>
      <div class="glow-layer"></div>
      <div class="particles-container"></div>
      <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
    </div>
    
    <header class="site-header">
      <!-- Animated background with stars -->
      <div class="stars"></div>
      
      <nav class="nav">
        <div class="nav-left">
          <a href="/">{{ _('Home') }}</a>
          <a href="/services">{{ _('Services') }}</a>
          <a href="/pricing">{{ _('Pricing') }}</a>
          <a href="/blog">{{ _('Blog') }}</a>
          <a href="/contact">{{ _('Contact') }}</a>
        </div>
        <div class="nav-right">
          {# –Ø–∑—ã–∫–æ–≤–æ–µ –º–µ–Ω—é #}
          {{ language_switcher() }}

          {% if current_user.is_authenticated %}
            <a href="{{ url_for('dashboard.index') }}">{{ _('Dashboard') }}</a>
            {% if current_user.is_admin %}
              <a href="{{ url_for('admin.dashboard') }}" class="admin-link">{{ _('Admin Panel') }}</a>
            {% endif %}
            <a href="{{ url_for('auth.logout') }}">{{ _('Logout') }}</a>
          {% else %}
            <a href="{{ url_for('auth.login') }}">{{ _('Login') }}</a>
            <a href="{{ url_for('auth.register') }}">{{ _('Register') }}</a>
          {% endif %}
        </div>
      </nav>
    </header>

    <main class="container">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="flash-message flash-{{ category }}">
              <span class="emoji-icon">{% if category == 'success' %}‚úì{% else %}!{% endif %}</span>
              <p>{{ message }}</p>
              <button class="flash-close">‚úï</button>
            </div>
          {% endfor %}
        {% endif %}
      {% endwith %}
      {% block content %}{% endblock %}
    </main>

    <footer class="site-footer">
      <div class="wave-animation">
        <div class="wave wave1"></div>
        <div class="wave wave2"></div>
      </div>
      <div class="footer-content">
        <p>{{ _('&copy; 2025 Rozoom-KI. All rights reserved.') }}</p>
        <nav class="footer-links" aria-label="Footer Navigation">
          <a href="{{ url_for('pages.impressum') }}" class="footer-link">{{ _('Impressum') }}</a>
          <a href="{{ url_for('pages.privacy') }}" class="footer-link">{{ _('Privacy Policy') }}</a>
          <a href="{{ url_for('pages.terms') }}" class="footer-link">{{ _('Terms of Service') }}</a>
        </nav>
      </div>
    </footer>
    
    <!-- Chat widget -->
    <div id="chat-widget" class="chat-widget high-contrast">
      <div id="chat-toggle" class="chat-toggle">
        <span class="emoji-icon">üí¨</span>
      </div>
      <div id="chat-window" class="chat-window hidden">
        <div class="chat-header">
          <div class="chat-header-title">
            <span>{{ _('Rozoom Assistant') }}</span>
          </div>
          <div class="language-selector">
            <button class="lang-button active" data-lang="de">DE</button>
            <button class="lang-button" data-lang="en">EN</button>
          </div>
          <div id="chat-close" class="chat-close">
            ‚úï
          </div>
        </div>
        <div id="chat-messages" class="chat-messages high-contrast"></div>
        <div id="chat-controls" class="chat-controls">
          <div class="chat-input-wrapper">
            <input id="chat-input" placeholder="{{ _('Type your message...') }}" />
            <button id="chat-send" class="chat-send">
              üì®
            </button>
          </div>
        </div>
      </div>
    </div>
    {% block scripts %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/particles.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/particles-init.js') }}"></script>
    <!-- Font Awesome –¥–ª—è —á–∞—Ç-–≤–∏–¥–∂–µ—Ç–∞ -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <script src="{{ url_for('static', filename='js/chat_widget.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chat_language.js') }}"></script>
    <script src="{{ url_for('static', filename='js/animations.js') }}"></script>
    <script src="{{ url_for('static', filename='js/background-animation.js') }}"></script>
    <script src="{{ url_for('static', filename='js/particles-sphere.js') }}"></script>
    <script src="{{ url_for('static', filename='js/language_switcher.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/footer-fix.js') }}"></script>
    <script>
      // Initialize Bootstrap tooltips and popovers
      document.addEventListener('DOMContentLoaded', function() {
        // Close flash messages
        document.querySelectorAll('.flash-close').forEach(button => {
          button.addEventListener('click', function() {
            this.closest('.flash-message').remove();
          });
        });
      });
    </script>
    
    <!-- –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ç–µ–º–Ω–æ–π –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ç–µ–º—ã -->
    <script src="{{ url_for('static', filename='js/dark-background.js') }}"></script>
    
    <!-- –ù–ï –∑–∞–≥—Ä—É–∂–∞—Ç—å –Ω–∏–∫–∞–∫–∏—Ö Font Awesome —Å–∫—Ä–∏–ø—Ç–æ–≤! -->
    <script>
      // –ë–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫ Font Awesome –∏ –¥—Ä—É–≥–∏—Ö –∏–∫–æ–Ω–æ—á–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
      document.addEventListener('DOMContentLoaded', function() {
        // –£–¥–∞–ª—è–µ–º –≤—Å–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏–∫–æ–Ω–∫–∏
        document.querySelectorAll('script').forEach(function(script) {
          if (script.src && (
              script.src.includes('fontawesome') || 
              script.src.includes('font-awesome') ||
              script.src.includes('icon-fallback')
          )) {
            script.remove();
          }
        });
        
        // –£–¥–∞–ª—è–µ–º –≤—Å–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ link-—Ç–µ–≥–∏
        document.querySelectorAll('link').forEach(function(link) {
          if (link.href && (
              link.href.includes('fontawesome') || 
              link.href.includes('font-awesome')
          )) {
            link.remove();
          }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω Bootstrap
        var modals = document.querySelectorAll('.modal');
        if (typeof bootstrap !== 'undefined' && bootstrap.Modal && modals.length > 0) {
          modals.forEach(function(modal) {
            new bootstrap.Modal(modal);
          });
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ CSRF —Ç–æ–∫–µ–Ω–∞ –¥–ª—è —Ñ–æ—Ä–º —É–¥–∞–ª–µ–Ω–∏—è
        document.querySelectorAll('form[action*="delete"]').forEach(function(form) {
            form.addEventListener('submit', function(e) {
                var csrfToken = form.querySelector('input[name="csrf_token"]');
                if (!csrfToken || !csrfToken.value) {
                    e.preventDefault();
                    console.error('CSRF —Ç–æ–∫–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç!');
                    alert('–û—à–∏–±–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: CSRF —Ç–æ–∫–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç');
                }
            });
        });
        
        // –ò—Å–ø—Ä–∞–≤–ª—è–µ–º —Ñ—É—Ç–µ—Ä –∏ –µ–≥–æ —Å—Å—ã–ª–∫–∏
        document.querySelectorAll('.footer-links a').forEach(function(link) {
            // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Å—Å—ã–ª–∫–∏ –≤ —Ñ—É—Ç–µ—Ä–µ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã
            link.style.pointerEvents = 'auto';
            link.style.cursor = 'pointer';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            link.addEventListener('click', function(e) {
                console.log('–§—É—Ç–µ—Ä —Å—Å—ã–ª–∫–∞ –Ω–∞–∂–∞—Ç–∞: ' + this.href);
            });
        });
      });
    </script>
    {% endblock %}
  </body>
</html>
