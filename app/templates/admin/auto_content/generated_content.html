{% extends 'admin/base.html' %}

{% block title %}Сгенерированный контент{% endblock %}

{% block content %}
<div class="admin-content">
  <div class="content-header">
    <h1>Сгенерированный контент</h1>
    <p class="lead">Просмотр и управление автоматически созданными статьями</p>
  </div>

  <div class="content-section">
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>ID</th>
            <th>Заголовок (EN)</th>
            <th>Статус</th>
            <th>Расписание</th>
            <th>Дата создания</th>
            <th>Дата публикации</th>
            <th>Действия</th>
          </tr>
        </thead>
        <tbody>
          {% for item in content %}
          <tr>
            <td>{{ item.id }}</td>
            <td>{{ item.title_en }}</td>
            <td>
              {% if item.status.value == 'published' %}
              <span class="badge bg-success">Опубликовано</span>
              {% elif item.status.value == 'planned' %}
              <span class="badge bg-warning">Запланировано</span>
              {% elif item.status.value == 'generating' %}
              <span class="badge bg-info">Генерируется</span>
              {% else %}
              <span class="badge bg-danger">Ошибка</span>
              {% endif %}
            </td>
            <td>{{ item.schedule.name if item.schedule else 'Нет' }}</td>
            <td>{{ item.created_at.strftime('%d.%m.%Y %H:%M') }}</td>
            <td>
              {% if item.published_at %}
              {{ item.published_at.strftime('%d.%m.%Y %H:%M') }}
              {% else %}
              -
              {% endif %}
            </td>
            <td>
              <div class="btn-group">
                <a href="{{ url_for('auto_content.view_content', id=item.id) }}" class="btn btn-sm btn-outline-primary">
                  <i class="fas fa-eye"></i>
                </a>
                
                {% if item.status.value == 'published' %}
                  {% if item.en_post_id %}
                  <a href="{{ url_for('blog.post', slug=item.en_post.slug) }}" target="_blank" class="btn btn-sm btn-outline-success" title="Просмотреть EN">
                    <i class="fas fa-external-link-alt"></i> EN
                  </a>
                  {% endif %}
                  
                  {% if item.de_post_id %}
                  <a href="{{ url_for('blog.post', slug=item.de_post.slug) }}" target="_blank" class="btn btn-sm btn-outline-info" title="Просмотреть DE">
                    <i class="fas fa-external-link-alt"></i> DE
                  </a>
                  {% endif %}
                {% elif item.status.value == 'failed' %}
                <form method="POST" action="{{ url_for('auto_content.publish_content', id=item.id) }}" style="display: inline-block;">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <button type="submit" class="btn btn-sm btn-outline-warning" title="Повторить публикацию">
                    <i class="fas fa-redo"></i>
                  </button>
                </form>
                {% endif %}
              </div>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="7" class="text-center">Контент пока не сгенерирован</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
